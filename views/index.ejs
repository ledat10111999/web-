<!DOCTYPE html>
<html>
<head lang="vi">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/stylesheets/bootstrap.css">
    <link rel="stylesheet" href="/stylesheets/Style.css">
    <!-- jquery -->
    <script src="/javascripts/jquery-3.4.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <!-- AngulatJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
    <!-- search bar -->
    <script src="/javascripts/searchBar.js"></script>
    <title>Trang chủ</title>
</head>

<body>
    <!-- Thanh Nav -->
    <div class="Navigator">
        <nav class="navbar navbar-expend-sm navbar-light bg-light">
            <div class="container">
                <!-- Logo -->
                <a href="/" class="nav-brand"><img height="120" src="/images/logo2.png" alt="logo"></a>
                <!-- Nav item signin/register -->
                <ul class="nav ml-auto">
                    <% if (!data.sign ) { %>

                    <li class="nav-item font-weight-bold"><a href="signin" class="nav-link ">Đăng nhập</a></li>
                    <li class="nav-item font-weight-bold"><a href="signup" class="nav-link">Đăng kí</a></li>
                    <% }else if(data.sign){%>


                    <li class="nav-item nav-username">
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary dropdown-toggle font-weight-bold"
                                data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false"><%=data.sign.First_name  %> <%=data.sign.Last_name  %> </button>
                            <div class="dropdown-menu">
                                <a href="/users/<%=data.sign.Email%>"  class="dropdown-item">Thông tin tài khoản</a>
                                <div class="dropdown-divider"></div>
                                <a href="/posted/<%=data.sign.ID %> " class="dropdown-item">Bài viết đã đăng</a>
                                <div class="dropdown-divider"></div>
                                <a href="/savePosts/<%=data.sign.Email%> " class="dropdown-item">Bài viết đã lưu</a>
                                <div class="dropdown-divider"></div>
                                <button class="signout dropdown-item" id="signout">Đăng xuất</button>
                            </div>
                        </div>
                    </li>
                    <% if (data.sign.QuyenHan == 'admin') { %>
                    <li style="margin-right: 10px;" class="nav-item"><a href="# "><button
                                class="btn btn-primary font-weight-bold">Trang quản trị</button> </a></li>
                    <% } %>
                    <li class="nav-item"><a href="DangTin"><button class="btn btn-primary font-weight-bold">Đăng
                                tin</button> </a></li>
                    <!-- <li class="nav-item"><a href="#" class="nav-link"> Chào mừng <%=data.sign.ho  %>  <%=data.sign.ten  %>  </a></li>
                            <li class="nav-item"><a href="DangTin"><button class="btn btn-primary font-weight-bold">Đăng tin</button></a></li>-->

                    <% } %>

                </ul>
        </nav>
    </div>
    <!-- Big Banner -->
    <div ng-app="myApp" ng-controller="controller1">
        <div class="banner">
            <div class="container">
                <!-- Slogan -->
                <h1 class="display-5 text-center banner-title text-white font-weight-bold">ĐÚNG NHÀ, ĐÚNG GIÁ, ĐÚNG THỜI
                    ĐIỂM</h1>
                <!-- Thanh tim kiem -->
                <div class="row searching-bar blur-bg">
                    <div class="col-md-2 pt-3">
                        <div class="form-group">
                            <select id="ThongTinMoTa" class="form-control w-100">
                                <option selected value="">Loại tin</option>
                                <option value="Phòng trọ">Phòng trọ, nhà trọ</option>
                                <option value="Nhà nguyên căn">Nhà thuê nguyên căn</option>
                                <option value="Tìm người ở ghép">Tìm người ở ghép</option>
                                <option value="Cho thuê căn hộ">Cho thuê căn hộ</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2 pt-3">
                        <div class="form-group">
                            <select id="selectCity" class="form-control w-100" >
                                <option value=" " selected>Tỉnh thành</option>
                                <%if(data.cities ){ %>
                                <% for(var i = 0 ; i< data.cities.length; i++){ %>
                                <option value="<%=data.cities[i]._name%>"> <%=data.cities[i]._name%> </option>
                                <% } %>
                                <% } %>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-2 pt-3">
                        <div class="form-group">
                            <select id="selectDistric" class="form-control w-100">
                                <option value=""> Chọn Quận huyện</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2 pt-3">
                        <div class="form-group">
                            <select id="selectWard" class="form-control w-100">
                                <option value=""> Chọn Phường/Xã</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2 pt-3">
                        <div class="form-group">
                            <select id="inputState" class="form-control w-100">
                                <option selected>Khoảng giá</option>
                                <option>Dưới 1 triệu</option>
                                <option value=" 1000000">1 triệu - 2 triệu</option>
                                <option value=" 2000000"> 2 triệu - 3 triệu</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-2 pt-3">
                        <button type="button" id="search" class="btn btn-primary btn-block"
                            ng-click="myClick(loaiTin)">Lọc tin</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Thanh Nav -->
        <div class="Nav2">
            <nav class="navbar navbar-expend-sm nav-custom navbar-light bg-nav">
                <div class="container justify-content-center">
                    <div class="row grid-divider">
                        <div class="col-sm-12">
                            <ul class="nav mr-auto">
                                <li class="nav-item"><a href="/" class="nav-link font-weight-bold text-white">Trang
                                        chủ</a></li>
                                <li class="nav-item"><a href="#" class="nav-link font-weight-bold text-white">Cho thuê
                                        phòng trọ</a></li>
                                <li class="nav-item"><a href="#" class="nav-link font-weight-bold text-white">Nhà cho
                                        thuê</a></li>
                                <li class="nav-item" ng-click="timClick()"><a href=""
                                        class="nav-link font-weight-bold text-white">Tìm người
                                        ở ghép</a></li>
                                <li class="nav-item"><a href="#" class="nav-link font-weight-bold text-white">Cho thuê
                                        căn hộ</a></li>
                                <li class="nav-item"><a href="#" class="nav-link font-weight-bold text-white">Hướng
                                        dẫn</a></li>
                                <li class="nav-item"><a href="#" class="nav-link font-weight-bold text-white">Nạp
                                        tiền</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Tin Noi Bat -->

        <div class="container">
            <h3>Tin nổi bật</h3>
            <div class="row ">
                <div class="col-sm-6" ng-repeat='x in data | filter: search '>
                    <a href="/DangTin/post/{{x.ID}} " style="text-decoration: none; color: #000;">
                        <div class="card mb-3" style="max-width: 540px;">
                            <div class="row no-gutters">
                                <div class="col-md-4">
                                    <img src="/{{x.image}}" height="200px" class="card-img" alt="">
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body">
                                        <h5 class="card-title">{{x.TieuDe}} </h5>
                                        <p class="card-text font-weight-bold">Giá:{{x.Gia}} </p>
                                        <p class="card-text">{{x.NoiDung}} </p>
                                        <p class="card-text">{{x.tenQuan + "-" + x.tenTp }} </p>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>

    </div>
<!-- Lọc thông tin từ thanh search bar bằng AngulaJS -->
    <script type="text/javascript">
        var app = angular.module('myApp', []);
        app.controller('controller1', function ($scope, $http) {
            var base_url = location.protocol + '//' + document.domain + ':' + location.port;
            $http.post(base_url + '/laydulieu').then((result) => {
                $scope.data = result.data;
            }).catch((err) => {
                $scope.data = err
            });
            $scope.myClick = function (tenTp, loaiTin) {
                $scope.search = {
                    tenTp:$('#selectCity').val(),
                    tenQuan: $("#selectDistric").val(),
                    tenPhuong: $("#selectWard").val(),
                    ThongTinMoTa: $("#ThongTinMoTa").val()
                }
            }
            $scope.timClick = function () {
                $scope.search = {
                    ThongTinMoTa: "Tìm người ở ghép"
                }
            }
        })
    </script>
    <!-- Xử lý socket.io -->
    <!-- <script src="/javascripts/index.js" type="text/javascript" ></script> -->
    <!-- angularJS -->

    <!-- signout -->
    <script src="/javascripts/sigout.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"
        integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1"
        crossorigin="anonymous"></script>
</body>
</html>